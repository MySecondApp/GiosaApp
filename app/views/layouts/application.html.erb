<!DOCTYPE html>
<html class="<%= theme_classes('bg-gray-100', 'bg-gray-900') %>">
  <head>
    <title><%= content_for(:title) || "Giosa App" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= yield :head %>

    <%# Enable PWA manifest for installable apps (make sure to enable in config/routes.rb too!) %>
    <%#= tag.link rel: "manifest", href: pwa_manifest_path(format: :json) %>

    <link rel="icon" href="/icon.png" type="image/png">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/icon.png">

    <%# Includes all stylesheet files in app/assets/stylesheets %>
    <%= stylesheet_link_tag :app, "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>
<body class="min-h-screen <%= theme_classes('bg-gray-100 text-black', 'bg-gray-900 text-white') %>" data-controller="flash-notifications">

    <!-- Notificaciones flash -->
    <% if notice %>
      <%
        # Determine notification type and title based on message
        if notice.include?('creado') || notice.include?('created')
          flash_type = 'success'
          flash_title = '‚úÖ Post Creado'
        elsif notice.include?('actualizado') || notice.include?('updated')
          flash_type = 'success'
          flash_title = 'üîÑ Post Actualizado'
        elsif notice.include?('eliminado') || notice.include?('deleted')
          flash_type = 'success'
          flash_title = 'üóëÔ∏è Post Eliminado'
        else
          flash_type = 'success'
          flash_title = '‚úÖ √âxito'
        end
      %>
      <div data-flash-notifications-message-value="<%= notice %>"
           data-flash-notifications-type-value="<%= flash_type %>"
           data-flash-notifications-title-value="<%= flash_title %>">
      </div>
    <% end %>
    
    <!-- Modern Navigation with Glass Morphism Effect -->
    <nav class="<%= theme_classes('bg-white/90 border-gray-200/50', 'bg-gray-900/90 border-gray-700/50') %> navbar-glass shadow-lg border-b backdrop-blur-md sticky top-0 z-50" data-controller="navbar">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-16">
          <!-- Logo with modern styling -->
          <%= link_to root_path, class: "logo-hover text-2xl font-bold gradient-text focus-outline" do %>
            <span class="bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
              GiosaApp
            </span>
          <% end %>
          
          <!-- Desktop Navigation -->
          <div class="hidden md:flex items-center space-x-2">
            <%= nav_link_to t('navigation.home'), root_path %>
            <%= nav_link_to t('navigation.posts'), posts_path %>
            <%= nav_link_to t('navigation.new_post'), new_post_path %>
            
            <!-- Divider -->
            <div class="<%= theme_classes('bg-gray-200', 'bg-gray-700') %> w-px h-6 mx-4"></div>
            
            <!-- Language Toggle -->
            <%= button_to toggle_locale_path, method: :post, 
                          title: t('locale.toggle'), 
                          class: "lang-toggle btn-press focus-outline #{theme_classes('bg-gradient-to-r from-blue-100 to-purple-100 hover:from-blue-200 hover:to-purple-200 text-blue-700 border-blue-200', 'bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-500 hover:to-purple-500 text-blue-100 border-blue-500')} w-10 h-10 rounded-xl border transition-all duration-300 flex items-center justify-center text-xs font-bold shadow-sm hover:shadow-lg" do %>
              <%= current_locale == :es ? "EN" : "ES" %>
            <% end %>
            
            <!-- Theme Toggle -->
            <%= button_to toggle_theme_path, method: :post, 
                          title: t('theme.toggle'),
                          class: "theme-icon btn-press focus-outline #{theme_classes('bg-gradient-to-r from-gray-100 to-gray-200 hover:from-gray-200 hover:to-gray-300 text-gray-700 border-gray-300', 'bg-gradient-to-r from-gray-700 to-gray-800 hover:from-gray-600 hover:to-gray-700 text-yellow-300 border-gray-600')} w-10 h-10 rounded-xl border transition-all duration-500 flex items-center justify-center text-lg shadow-sm hover:shadow-lg float-animation" do %>
              <span class="<%= session[:dark_theme] ? 'rotate' : '' %>">
                <%= session[:dark_theme] ? "‚òÄÔ∏è" : "üåô" %>
              </span>
            <% end %>
          </div>
          
          <!-- Mobile menu button -->
          <div class="md:hidden">
            <button type="button" 
                    class="<%= theme_classes('text-gray-500 hover:text-gray-700 hover:bg-gray-100', 'text-gray-400 hover:text-gray-200 hover:bg-gray-700') %> p-2 rounded-lg transition-all duration-200 focus-outline" 
                    data-navbar-target="button"
                    data-action="click->navbar#toggle"
                    aria-expanded="false"
                    aria-label="Toggle navigation">
              <div class="w-6 h-6 flex flex-col justify-center items-center space-y-1">
                <span class="hamburger-line block w-5 h-0.5 <%= theme_classes('bg-gray-600', 'bg-gray-300') %> transition-all duration-300"></span>
                <span class="hamburger-line block w-5 h-0.5 <%= theme_classes('bg-gray-600', 'bg-gray-300') %> transition-all duration-300"></span>
                <span class="hamburger-line block w-5 h-0.5 <%= theme_classes('bg-gray-600', 'bg-gray-300') %> transition-all duration-300"></span>
              </div>
            </button>
          </div>
        </div>
      </div>
      
    <!-- Mobile Navigation Menu (hidden by default) -->
    <div data-navbar-target="menu" class="hidden md:hidden">
      <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3 <%= theme_classes('bg-white border-t border-gray-200', 'bg-gray-800 border-t border-gray-700') %>">
        <%= link_to t('navigation.home'), root_path, class: "mobile-menu-item #{current_page?(root_path) ? theme_classes('bg-blue-100 text-blue-700', 'bg-blue-900 text-blue-300') : theme_classes('text-gray-700 hover:bg-gray-50', 'text-gray-300 hover:bg-gray-700')} block px-3 py-2 rounded-md text-base font-medium transition-colors" %>
        <%= link_to t('navigation.posts'), posts_path, class: "mobile-menu-item #{current_page?(posts_path) ? theme_classes('bg-blue-100 text-blue-700', 'bg-blue-900 text-blue-300') : theme_classes('text-gray-700 hover:bg-gray-50', 'text-gray-300 hover:bg-gray-700')} block px-3 py-2 rounded-md text-base font-medium transition-colors" %>
        <%= link_to t('navigation.new_post'), new_post_path, class: "mobile-menu-item #{current_page?(new_post_path) ? theme_classes('bg-blue-100 text-blue-700', 'bg-blue-900 text-blue-300') : theme_classes('text-gray-700 hover:bg-gray-50', 'text-gray-300 hover:bg-gray-700')} block px-3 py-2 rounded-md text-base font-medium transition-colors" %>
        
        <div class="border-t <%= theme_classes('border-gray-200', 'border-gray-600') %> pt-4 mt-4">
          <div class="flex items-center space-x-4 px-3">
            <!-- Language Toggle Mobile -->
            <%= button_to toggle_locale_path, method: :post, 
                          title: t('locale.toggle'), 
                          class: "flex-1 #{theme_classes('bg-blue-50 hover:bg-blue-100 text-blue-700 border-blue-200', 'bg-blue-900/50 hover:bg-blue-800/50 text-blue-300 border-blue-700')} px-3 py-2 rounded-lg border transition-all duration-300 flex items-center justify-center text-sm font-medium" do %>
              <span class="mr-1">üåê</span>
              <%= current_locale == :es ? "EN" : "ES" %>
            <% end %>
            
            <!-- Theme Toggle Mobile -->
            <%= button_to toggle_theme_path, method: :post, 
                          title: t('theme.toggle'),
                          class: "flex-1 #{theme_classes('bg-gray-50 hover:bg-gray-100 text-gray-700 border-gray-200', 'bg-gray-800/50 hover:bg-gray-700/50 text-yellow-300 border-gray-600')} px-3 py-2 rounded-lg border transition-all duration-300 flex items-center justify-center text-sm font-medium" do %>
              <span class="mr-1"><%= session[:dark_theme] ? "‚òÄÔ∏è" : "üåô" %></span>
              <%= session[:dark_theme] ? "‚òÄÔ∏è" : "üåô" %>
            <% end %>
          </div>
        </div>
      </div>
    </div>
    </nav>
    
    <main class="py-7">
      <%= yield %>
    </main>
    
    <!-- Container for notifications -->
    <div id="flash-notifications-container" class="fixed bottom-6 right-6 z-50 space-y-4 max-w-md"></div>

    <%# Notification settings disabled - uncomment to re-enable %>
    <%# render "shared/notification_settings" %>
  </body>
</html>
